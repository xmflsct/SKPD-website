---
import { documentToHtmlString } from '@contentful/rich-text-html-renderer'
import { Image } from 'astro:assets'
import { richTextOptions } from '../lib/richTextOptions'
import { formatDateRangeDutch } from '../lib/dateFormatter'
import type { CollectionEntry } from 'astro:content'

interface Props {
  event: CollectionEntry<'events'>['data']
}

const {
  event: { data }
} = Astro.props

const dateRange = formatDateRangeDutch(data.dateStart, data.dateEnd)
const imageUrl = data.featuredImage?.fields?.file?.url 
  ? `https:${data.featuredImage.fields.file.url}?w=782&q=80&fm=webp` 
  : null
---

<article class='border-b mb-6 pb-6'>
  <h1 class='text-2xl md:text-3xl font-bold mb-2'>{data.name}</h1>

  <time class='flex items-center gap-2 text-gray-600 mb-4' datetime={data.dateStart}>
    <svg class='w-5 h-5' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
      <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'></path>
    </svg>
    {dateRange}
  </time>

  {
    data.featuredImage && imageUrl && (
      <figure class='mb-6'>
        <Image
          src={imageUrl}
          alt={data.featuredImage.fields.title || data.name}
          width={782}
          height={
            Math.round((782 / data.featuredImage.fields.file.details.image.width) *
            data.featuredImage.fields.file.details.image.height)
          }
          loading='eager'
          class='rounded-lg shadow-sm'
        />
      </figure>
    )
  }

  {
    data.description && (
      <div class='prose prose-lg max-w-none' set:html={documentToHtmlString(data.description, richTextOptions)} />
    )
  }
</article>
