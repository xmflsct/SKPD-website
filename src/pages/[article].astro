---
import { getCollection } from 'astro:content'
import { contentfulSlug } from '../lib/contentful'
import Layout from '../layouts/Layout.astro'
import Event from '../layouts/Event.astro'

export async function getStaticPaths() {
  const events = await getCollection('events')
  return events.map(event => ({
    params: { article: contentfulSlug(event.data.name) },
    props: { data: event.data }
  }))
}

const { data } = Astro.props

// Extract description from rich text if available (first 160 chars)
const getPlainTextDescription = (description: any): string => {
  if (!description?.content) return ''
  const text = description.content
    .filter((node: any) => node.nodeType === 'paragraph')
    .map((node: any) => node.content?.map((c: any) => c.value || '').join(''))
    .join(' ')
  return text.slice(0, 160) + (text.length > 160 ? '...' : '')
}

const eventDescription = getPlainTextDescription(data.description)
const ogImage = data.featuredImage?.fields?.file?.url
  ? `https:${data.featuredImage.fields.file.url}?w=1200&h=630&fit=fill`
  : undefined
---

<Layout 
  title={data.name}
  keywords={['SKPD', 'keramiek', data.name]}
  description={eventDescription || `${data.name} - SKPD evenement`}
  ogImage={ogImage}
>
  <Event event={data} />
</Layout>
